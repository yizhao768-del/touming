<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>小透明的少女心抽奖</title>
  <meta name="description" content="精致可爱、少女心十足的抽奖页面，固定奖品顺序展示，适合直接部署在 GitHub Pages。" />
  <meta name="theme-color" content="#ff9ecf" />
  <style>
    :root{ --pink:#ff9ecf; --pink-2:#ffb7dc; --rose:#ff6fa1; --lav:#c7b7ff; --cream:#fff7fb; --deep:#874a74; --shadow:0 10px 30px rgba(255,105,180,.25); --radius:22px; }
    html,body{height:100%}
    body{margin:0; font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","PingFang SC","Hiragino Sans GB","Microsoft YaHei",Helvetica,Arial,sans-serif; background: radial-gradient(1200px 800px at 20% -10%, #ffe6f5 0%, #fff 40%), radial-gradient(800px 600px at 120% 10%, #ffe9ff 0%, #fff 50%), linear-gradient(180deg, #fff 0%, #fff 100%); color:#4b2a3d; -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility; overflow-x:hidden;}
    .float-heart{ position:fixed; pointer-events:none; opacity:.16; animation: float 12s linear infinite;}
    .float-heart::before{content:"❤"; font-size:28px; color:var(--pink); text-shadow:0 0 10px rgba(255,158,207,.35)}
    @keyframes float{0%{transform:translateY(100vh) scale(.8) rotate(0)}100%{transform:translateY(-20vh) scale(1.2) rotate(360deg)}}
    .wrap{ min-height:100%; display:flex; align-items:center; justify-content:center; padding:20px; }
    .card{ width:min(520px,95vw); background:linear-gradient(180deg,#fff,var(--cream)); border-radius:var(--radius); box-shadow:var(--shadow); position:relative; overflow:hidden; border:1px solid #ffd6eb; }
    .ribbon{ position:absolute; inset:0; pointer-events:none; opacity:.4; background: radial-gradient(800px 120px at 50% -20%, rgba(255,182,219,.45), transparent 60%), radial-gradient(120px 120px at 10% 20%, rgba(199,183,255,.45), transparent 60%), radial-gradient(160px 160px at 90% 10%, rgba(255,223,240,.7), transparent 60%); filter:blur(8px); }
    header{ padding:28px 22px 0; text-align:center; }
    .title{ font-size:26px; font-weight:800; color:var(--deep); letter-spacing:1px; text-shadow:0 2px 0 #ffd4ea, 0 8px 22px rgba(255,158,207,.45); }
    .content{ padding:24px 20px 16px; display:flex; flex-direction:column; align-items:center; gap:14px; }
    .panel{ width:100%; background:linear-gradient(180deg,#fff,#fff7fb); border-radius:18px; border:1px dashed #ffcbe6; padding:18px 16px; text-align:center; }
    .msg{ font-size:18px; line-height:1.7; }
    .prize{ font-size:22px; font-weight:900; color:#c23f7a; text-shadow:0 1px 0 #fff; }
    .note{ font-size:14px; color:#8a5a78; }
    .btn{ appearance:none; border:none; cursor:pointer; padding:14px 22px; border-radius:14px; font-size:18px; font-weight:800; letter-spacing:.5px; background: radial-gradient(120% 140% at 30% 20%, #ffd1ea 0%, #ffb5dd 45%, #ff8fc6 100%); color:#6d234c; box-shadow: 0 10px 0 #ff78b9, 0 14px 24px rgba(255,120,185,.35); transition: transform .08s ease, box-shadow .08s ease; width:90%; max-width:340px; }
    .btn:active{ transform: translateY(4px); box-shadow: 0 6px 0 #ff78b9, 0 10px 16px rgba(255,120,185,.3); }
    .btn[disabled]{ opacity:.65; cursor:not-allowed; }
    .loading{ display:flex; align-items:center; justify-content:center; gap:10px; height:72px; }
    .heart{ width:14px; height:14px; background: var(--rose); transform: rotate(45deg); position:relative; box-shadow:0 6px 18px rgba(255,111,161,.4) inset, 0 0 0 4px rgba(255,255,255,.6) inset; animation: beat 1.1s infinite ease-in-out; }
    .heart::before,.heart::after{ content:""; position:absolute; width:14px; height:14px; background:var(--rose); border-radius:50%; }
    .heart::before{ top:-7px; left:0; } .heart::after{ left:-7px; top:0; }
    .heart:nth-child(2){ animation-delay:.15s; filter:hue-rotate(20deg)} .heart:nth-child(3){ animation-delay:.3s; filter:hue-rotate(40deg)}
    @keyframes beat{ 0%,100%{ transform: rotate(45deg) scale(.85);} 50%{ transform: rotate(45deg) scale(1.12);} }
    .tag{ display:inline-block; padding:6px 10px; background:#fff; border:1px solid #ffd2ea; border-radius:999px; font-size:12px; color:#a15383; box-shadow:0 6px 16px rgba(255,182,219,.3); }
    footer{ padding:6px 16px 24px; text-align:center; font-size:12px; color:#a16a8c; }
    .tiny{ opacity:.85 }
    @supports (backdrop-filter: blur(6px)){ .card{ backdrop-filter: blur(3px); } }
    @media (prefers-color-scheme: dark){ body{ background: radial-gradient(1200px 800px at 20% -10%, #3b2d3b 0%, #2a1f2a 40%), linear-gradient(180deg, #2a1f2a, #241b24); color:#ffe7f5; } .card{ background: linear-gradient(180deg, #3b2d3b, #2a1f2a); border-color:#5a3e56 } .panel{ background:linear-gradient(180deg, #48344a, #3a2a3c); border-color:#6c4865 } .title{ text-shadow:none; color:#ffe5f4 } .btn{ color:#3c0f28 } .note,.tiny{ color:#f9dcec } }

    /* reveal 微动效 */
    .reveal{ animation: reveal .18s ease-out both; will-change: transform, opacity, filter; }
    @keyframes reveal{ from{ opacity:0; transform: scale(.98); filter: blur(6px);} to{ opacity:1; transform: scale(1); filter: blur(0);} }
    @media (prefers-reduced-motion: reduce){ .reveal{ animation:none; } }

    /* 终章艺术字 + 扫光一次 */
    .hero-text{ font-size:26px; font-weight:900; line-height:1.5; text-align:center; padding:14px 8px; letter-spacing:.6px; background: linear-gradient(90deg, #ff6fa1, #ffb7dc, #c7b7ff 80%); -webkit-background-clip:text; background-clip:text; color:transparent; -webkit-text-stroke:.8px rgba(255,180,220,.85); text-shadow:0 0 6px rgba(255,230,245,.75), 0 6px 18px rgba(255,143,198,.28); position:relative; overflow:hidden; opacity:0; transform:translateY(6px); animation: heroFade .6s ease-out forwards; }
    .hero-text .glow{ text-shadow:0 2px 10px rgba(255,170,210,.55), 0 0 22px rgba(199,183,255,.35); }
    .hero-text.hero-sweep::before{ content:""; position:absolute; top:0; left:-40%; width:40%; height:100%; background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.75) 45%, rgba(255,255,255,0) 100%); transform: skewX(-18deg); filter: blur(1px); animation: sweep 2.2s ease-out .3s 1 forwards; pointer-events:none; }
    @keyframes heroFade{ to{ opacity:1; transform: translateY(0);} }
    @keyframes sweep{ 0%{ left:-60% } 100%{ left:120% } }
    .blink-heart{ display:inline-block; margin-left:6px; opacity:0; }
    .blink-heart.show{ animation: blink .9s ease-in-out 1 forwards; }
    @keyframes blink{ 0%{ opacity:0; transform: scale(.6);} 40%{ opacity:1; transform: scale(1.12);} 100%{ opacity:0; transform: scale(.8);} }

    /* 覆盖层（信封样式） */
    .overlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(255,240,248,.82); backdrop-filter: blur(6px); z-index:999; padding:22px; }
    .overlay-card{ width:min(520px,92vw); background:linear-gradient(180deg,#fff,#fff7fb); border:1px solid #ffd6eb; border-radius:22px; box-shadow:var(--shadow); padding:24px 18px; text-align:center; }
    .overlay-card.envelope{ position:relative; padding-top:36px; }
    .envelope::before{ content:""; position:absolute; top:0; left:0; right:0; height:40px; border-radius:18px 18px 0 0; background:linear-gradient(180deg,#fff8fd,#ffeaf6); border-bottom:1px solid #ffd6eb; }
    .envelope .gold-line{ width:86%; height:2px; margin:6px auto 14px; background:linear-gradient(90deg,#d6a84d,#f5d07a,#d6a84d); border-radius:999px; }
    .envelope .seal{ position:absolute; top:-16px; left:50%; transform:translateX(-50%); width:44px; height:44px; border-radius:50%; background: radial-gradient(circle at 30% 30%, #ff89c4, #ff5ea9); box-shadow: inset 0 6px 12px rgba(0,0,0,.15), 0 6px 14px rgba(255,120,185,.35); }
    .envelope .seal::after{ content:"✿"; position:absolute; color:#fff; font-weight:900; font-size:20px; left:50%; top:50%; transform:translate(-50%,-54%); opacity:.9 }

    @media (max-width:420px){ .title{font-size:22px} .msg{font-size:16px} .prize{font-size:20px} .panel{padding:16px 12px} .btn{width:96%; font-size:17px} .hero-text{font-size:22px} }
  </style>
</head>
<body>
  <span class="float-heart" style="left:6vw; animation-duration:14s; animation-delay:0s"></span>
  <span class="float-heart" style="left:22vw; animation-duration:18s; animation-delay:1s"></span>
  <span class="float-heart" style="left:48vw; animation-duration:16s; animation-delay:.5s"></span>
  <span class="float-heart" style="left:76vw; animation-duration:20s; animation-delay:2.2s"></span>

  <div class="wrap">
    <div class="card" role="region" aria-label="抽奖卡片">
      <div class="ribbon" aria-hidden="true"></div>
      <header><div class="title">小透明的特别抽奖福利</div></header>
      <main class="content">
        <div class="panel" id="panel"><div class="msg" id="message">小透明恭喜你获得特别抽奖福利，你准备好了吗？</div></div>
        <button class="btn" id="actionBtn" aria-live="polite">确定</button>
        <div class="tag" id="hint">点击确定开始抽奖</div>
      </main>
      <footer><div class="tiny">© 小玉为小透明特别定制 · GitHub Pages 单文件可用</div></footer>
    </div>
  </div>

  <!-- 礼封覆盖层（信封样式） -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-labelledby="overlayMsg" aria-describedby="overlayMsg">
    <div class="overlay-card envelope">
      <span class="seal" aria-hidden="true"></span>
      <div class="gold-line" aria-hidden="true"></div>
      <div class="overlay-msg" id="overlayMsg">哇恭喜透明运气太好了，奖励再来一次</div>
      <button class="btn" id="overlayBtn">揭开礼封</button>
    </div>
  </div>

  <!-- 粒子画布（礼花 + 樱瓣） -->
  <canvas id="confetti" style="position:fixed; inset:0; pointer-events:none"></canvas>

  <script>
  (function(){
    // ===== DOM =====
    const panel = document.getElementById('panel');
    const message = document.getElementById('message');
    const btn = document.getElementById('actionBtn');
    const hint = document.getElementById('hint');
    const overlay = document.getElementById('overlay');
    const overlayMsg = document.getElementById('overlayMsg');
    const overlayBtn = document.getElementById('overlayBtn');

    // ===== 固定流程（严格按用户要求） =====
    // 红包 → 皮肤(含提示) → 无条件券 → 赛博小蛋糕 → 多行祝福(打字机) → 终章艺术字
    const STEPS = [
      { type:'prize', prize:'52元红包', note:'哇恭喜透明运气太好了，奖励再来一次', overlayAfter:true },
      { type:'prize', prize:'无畏契约任意皮肤一个（选好告诉小玉领取）', note:'今天是透明的幸运日，免费再次奖励三次抽奖' },
      { type:'prize', prize:'无条件要求劵（仅可对小玉使用）' },
      { type:'prize', prize:'赛博小蛋糕（联系小玉领取）' },
      { type:'bless', prize:'亲爱的透明\n最终大奖是：祝你平平安安，无忧无虑\n希望你可以越来越好，永远都是小孩\n任何困难和不开心都可以和我说\n生日快乐，小朋友！！！' },
      { type:'ending' }
    ];
    let idx = -1; let loadingTimer = null; let pendingOverlay = false; // 仅在红包步：下一次点击“确定”先弹礼封

    // ===== Canvas 粒子（礼花 + 樱瓣） =====
    const canvas = document.getElementById('confetti'); const ctx = canvas.getContext('2d');
    let W,H; let pieces=[]; let petals=[]; let rafId=null; let petalTimer=null;
    function resize(){ W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
    addEventListener('resize', resize); resize();
    function rand(a,b){ return Math.random()*(b-a)+a; }
    function makeConfetti(){
      const colors = ['#ff79b5','#ffb6dc','#ffd6ea','#c7b7ff','#fff0f8'];
      for(let i=0;i<70;i++){
        const r = Math.random(); let shape='rect'; if(r<1/14) shape='heart'; else if(r<2/14) shape='star';
        pieces.push({ x:rand(0,W), y:-10, w:rand(6,10), h:rand(10,16), vy:rand(2,4), vx:rand(-1,1), rot:rand(0,Math.PI), vr:rand(-.1,.1), color:colors[(Math.random()*colors.length)|0], shape });
      }
    }
    function startPetals(){
      const colors=['#ffd6ea','#ffcbe6','#ffe1f2']; let count=0; if(petalTimer) clearInterval(petalTimer);
      petalTimer = setInterval(()=>{ if(count>=12){ clearInterval(petalTimer); return; }
        petals.push({ x:rand(0,W), y:-10, rx:rand(6,9), ry:rand(10,14), vx:rand(-.3,.3), vy:rand(.8,1.6), rot:rand(0,Math.PI), vr:rand(-.02,.02), color:colors[(Math.random()*colors.length)|0] });
        count++; if(!rafId) draw();
      }, 400);
      setTimeout(()=>{ clearInterval(petalTimer); }, 2500);
    }
    function draw(){
      ctx.clearRect(0,0,W,H);
      // confetti
      pieces.forEach(p=>{ ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot); ctx.fillStyle=p.color;
        if(p.shape==='rect') ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
        else if(p.shape==='heart'){ const s=Math.min(p.w,p.h)*.7; ctx.beginPath(); ctx.moveTo(0,s/2); ctx.bezierCurveTo(s,-s/3,s/2,-s,0,-s/3); ctx.bezierCurveTo(-s/2,-s,-s,-s/3,0,s/2); ctx.fill(); }
        else if(p.shape==='star'){ const spikes=5, outer=Math.max(p.w,p.h)/2, inner=outer/2.6; let rotStar=Math.PI/2*3, x=0, y=0; ctx.beginPath(); ctx.moveTo(0,-outer); for(let i=0;i<spikes;i++){ x=Math.cos(rotStar)*outer; y=Math.sin(rotStar)*outer; ctx.lineTo(x,y); rotStar+=Math.PI/spikes; x=Math.cos(rotStar)*inner; y=Math.sin(rotStar)*inner; ctx.lineTo(x,y); rotStar+=Math.PI/spikes; } ctx.closePath(); ctx.fill(); }
        ctx.restore(); p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr; });
      pieces = pieces.filter(p=>p.y < H+20);
      // petals
      petals.forEach(pt=>{ ctx.save(); ctx.translate(pt.x,pt.y); ctx.rotate(pt.rot); ctx.globalAlpha=.9; ctx.fillStyle=pt.color; ctx.beginPath(); ctx.ellipse(0,0, pt.rx, pt.ry, 0, 0, Math.PI*2); ctx.fill(); ctx.restore(); pt.x+=pt.vx; pt.y+=pt.vy; pt.rot+=pt.vr; });
      petals = petals.filter(pt=>pt.y < H+30);
      rafId = requestAnimationFrame(draw);
    }
    function burstConfetti(){ makeConfetti(); if(!rafId) draw(); setTimeout(()=>{ cancelAnimationFrame(rafId); rafId=null; pieces=[]; ctx.clearRect(0,0,W,H); }, 1800); }

    // ===== 打字机 Pro（节奏 + “生日快乐”停顿 + 终心闪） =====
    function typeWriterPro(text, el, done){
      el.textContent=''; const heart=document.createElement('span'); heart.className='blink-heart'; heart.textContent='❤';
      const arr=[...text]; let i=0; const key='生日快乐';
      (function tick(){
        if(i>=arr.length){ el.appendChild(heart); requestAnimationFrame(()=>heart.classList.add('show')); setTimeout(()=>{ heart.remove(); done&&done(); },900); return; }
        const ch=arr[i++]; el.textContent+=ch; let delay=28; if(/[，。！？、,.!?]/.test(ch)) delay=120; if(el.textContent.endsWith(key)){ el.style.display='inline-block'; el.animate([{transform:'scale(1)'},{transform:'scale(1.04)'}],{duration:220,easing:'ease-out'}); delay=220; } setTimeout(tick, delay);
      })();
    }

    // ===== 渲染 =====
    function setLoading(){ panel.innerHTML = '<div class="loading" aria-live="polite" aria-busy="true"><div class="heart"></div><div class="heart"></div><div class="heart"></div></div><div class="note">抽奖进行中，请稍候…</div>'; btn.disabled = true; hint.textContent = '正在抽奖…'; }

    function showPrize(step){
      if(step.type === 'ending'){
        panel.innerHTML = '<div class="hero-text" id="heroText">小透明不止今天，<br/>每一天都是你的<span class="glow">幸运日</span>！！！</div>';
        const hero = document.getElementById('heroText'); requestAnimationFrame(()=> hero.classList.add('hero-sweep'));
        btn.style.display = 'none'; hint.textContent = ''; burstConfetti(); startPetals(); return;
      }
      if(step.type === 'bless'){
        panel.innerHTML = '<div class="msg"></div><div class="prize" id="typebox" style="font-size:18px; line-height:1.9; font-weight:700; white-space:pre-wrap;"></div>';
        panel.classList.remove('reveal'); void panel.offsetWidth; panel.classList.add('reveal');
        btn.disabled = false; btn.textContent = '确定'; hint.textContent = '继续抽下一个';
        const box=document.getElementById('typebox'); typeWriterPro(step.prize, box);
        burstConfetti(); return;
      }
      // 普通奖品
      const isParagraph = step.prize.length > 40;
      if(isParagraph){ panel.innerHTML = '<div class="msg"></div><div class="prize" id="typebox" style="font-size:18px; line-height:1.9; font-weight:700; white-space:pre-wrap;"></div>' + (step.note?('<div class="note" style="margin-top:8px">'+step.note+'</div>'):''); }
      else{ panel.innerHTML = '<div class="msg">恭喜获得</div><div class="prize">'+step.prize+'</div>' + (step.note?('<div class="note" style="margin-top:8px">'+step.note+'</div>'):''); }
      panel.classList.remove('reveal'); void panel.offsetWidth; panel.classList.add('reveal');
      btn.disabled = false; btn.textContent = '确定'; hint.textContent = '继续抽下一个';
      // 仅红包步：下一次点击先弹礼封
      pendingOverlay = !!step.overlayAfter;
      burstConfetti(); if(isParagraph){ const box=document.getElementById('typebox'); if(box) typeWriterPro(step.prize, box); }
    }

    function next(){
      idx++; if(idx >= STEPS.length) return; setLoading(); clearTimeout(loadingTimer);
      // 抽奖等待 2.2s（期待感）
      loadingTimer = setTimeout(()=>{ const step = STEPS[idx]; showPrize(step); }, 2200);
    }

    // ===== 事件 =====
    btn.addEventListener('click', ()=>{
      if(btn.disabled) return;
      if(pendingOverlay){ overlayMsg.textContent='哇恭喜透明运气太好了，奖励再来一次'; overlay.style.display='flex'; pendingOverlay=false; return; }
      next();
    });
    overlayBtn.addEventListener('click', ()=>{ overlay.style.display='none'; next(); });

    // 初始文案
    message.textContent = '小透明恭喜你获得特别抽奖福利，你准备好了吗？';
    hint.textContent = '点击确定开始抽奖';

    // ====== 内置自检：?test=1 触发（不改动真实流程） ======
    function runSelfTests(){
      const results = [];
      function ok(name, cond){ results.push((cond? '✅':'❌') + ' ' + name); if(!cond) throw new Error('Test failed: '+name); }
      ok('按钮存在', !!btn);
      ok('面板存在', !!panel);
      // 模拟：点击开始→红包→点击确定弹礼封→揭开礼封→皮肤→无条件券→赛博小蛋糕→祝福→终章
      idx = -1; const saveNext = next; next = function(){ idx++; const step = STEPS[idx]; showPrize(step); };
      btn.click(); ok('进入第1步（红包）', idx===0);
      btn.click(); ok('红包后点击确定触发礼封', overlay.style.display==='flex');
      overlayBtn.click(); ok('礼封后进入第2步（皮肤）', idx===1);
      btn.click(); ok('进入第3步（无条件券）', idx===2);
      btn.click(); ok('进入第4步（赛博小蛋糕）', idx===3);
      btn.click(); ok('进入第5步（祝福打字机）', idx===4);
      btn.click(); ok('进入第6步（终章艺术字）', idx===5);
      ok('终章隐藏按钮', getComputedStyle(btn).display==='none');
      console.log(results.join('\n'));
      next = saveNext;
    }
    if(new URLSearchParams(location.search).get('test')==='1'){ try{ runSelfTests(); }catch(e){ console.error(e); } }
  })();
  </script>
</body>
</html>
